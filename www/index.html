<!DOCTYPE HTML>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <meta http-equiv="Content-Security-Policy" content="default-src * data:; style-src * 'unsafe-inline'; script-src * 'unsafe-inline' 'unsafe-eval'">
    <script src="components/loader.js"></script>
    
    <link rel="stylesheet" href="components/loader.css">
    <link rel="stylesheet" href="css/style.css">
    
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.0/jquery.min.js"></script> 
    <script>
        ons.bootstrap();
    var cnt=0;
    var startH="";
    var endH="";
    
   document.addEventListener("deviceready", onDeviceReady, false);
    function onDeviceReady() { 
        modal.show();              
         var jqxhr = $.ajax( "http://172.20.200.71/php/core/noteServer/locationInfo.json" )
          .done(function(data) {
              startH=data.Location.appConfig.defaults.start;
              endH=data.Location.appConfig.defaults.end;
               console.log("ajx start time is--"+startH+" End time is--"+endH);
               
               var timeLimitStatus=validateTime();
               // console.log("out sider time status--"+timeLimitStatus);
                if(timeLimitStatus==1)
                {
                    var refreshIntervalId=setInterval(function()
                    {    
                        var timeLimitStatus=validateTime();
                        console.log("time status is--"+timeLimitStatus);
                        if(timeLimitStatus==0)
                        {      
                          // console.log("break interval");
                           clearInterval(refreshIntervalId);
                        }
                       // console.log("location start");
                       var options = {maximumAge: 0, timeout: 10000, enableHighAccuracy:true};
                        navigator.geolocation.getCurrentPosition(onSuccess, onError,options);
                       // console.log("location end");
                    },(1000*30));
                }
        
          })
          .fail(function() {
            alert( "error" ); 
          });
    }
   
   function validateTime()
   {
        var date = new Date();
        var flag=0;
        
        var currH=date.getHours();
        // var startH=7;
        // var endH=19;
        //console.log("start time is--"+startH+" End time is--"+endH);
        if(currH>=startH && currH <endH) 
        { 
            console.log('open hrs'); 
            flag=1;
        } 
        else
        {
            console.log('closed hrs'); 
            flag=0;
        }
        console.log("flag is--"+flag);
        return flag;
   }
    
    function onSuccess(position) {          
      //TODO: AJAX   
       modal.hide(); 
      $("#pageContain").show();
      $("#errorMsg").hide();
    var positionLongitude=position.coords.longitude;
    var positionLatitude=position.coords.latitude;
        
    var jqxhr = $.ajax({
      method: "POST", 
      url: "http://172.20.200.71/php/core/noteServer/locationDetails.php",
      data: { positionLongitude: positionLongitude , positionLatitude: positionLatitude } 
    })
    .done(function(msg) {  
        console.log("success--"+msg);
    })
    .fail(function() {       
        console.log("Error");
    }); 
      
      //$.post( "http://ip/file.ext", {longitude: position.coords.longitude, latitude: position.coords.latitude, uuid: device.uuid, nickname: 'Kaustubh'  } );
    }
       
    function onError(error) { 
       //console.log("get Location --fail "); 
       modal.hide(); 
       if(error.code==3)
       {          
           $("#pageContain").hide();
           $("#errorMsg").show();           
       }
       console.log('code: '    + error.code    + '\n' + 'message: ' + error.message + '\n');
    }
    
    function exitApp()
    {
        modal.show();
        setTimeout('modal.hide()', 2000);
        navigator.app.exitApp();
    }
    
    function post(path, params, method) {
          method = method || "post"; // Set method to post by default if not specified.
          var form = document.createElement("form");
          form.setAttribute("method", method);
          form.setAttribute("action", path);
          for(var key in params) {
            if(params.hasOwnProperty(key)) {
              var hiddenField = document.createElement("input");
              hiddenField.setAttribute("type", "hidden");
              hiddenField.setAttribute("name", key);
              hiddenField.setAttribute("value", params[key]);
              form.appendChild(hiddenField);
            }
        }
        document.body.appendChild(form);
        form.submit();
    }         
    </script> 
</head>
<body>
    <ons-sliding-menu var="app.slidingMenu" menu-page="menu.html" main-page="page1.html" side="left" type="overlay" max-slide-distance="200px">
    </ons-sliding-menu>
</body>
</html>

